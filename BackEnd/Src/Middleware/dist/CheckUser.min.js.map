{"version":3,"sources":["CheckUser.js"],"names":["_User","_interopRequireDefault","require","CheckUser","req","res","next","authHeader","tokenParts","apiKey","apiKeyParts","userId","user","regeneratorRuntime","async","_context","prev","headers","authorization","abrupt","status","json","message","split","length","error","awrap","sent","t0","console","stop"],"mappings":"2FAAA,IAAAA,MAAAC,uBAAAC,QAAA,6FACA,IAAMC,UAAY,SAAOC,EAAKC,EAAKC,GAAjB,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAT,MAAA,KAAA,EAAA,GACRC,EAAaH,EAAIa,QAAQC,cADjB,CAAAH,EAAAT,KAAA,EAAA,MAAA,OAAAS,EAAAI,OAAA,SAGLd,EAAIe,OAAO,KAAKC,KAAK,CAAEC,QAAS,kCAH3B,KAAA,EAAA,GADlB,KAMUd,EAAaD,EAAWgB,MAAM,MANxCC,QAAA,WAAAhB,EAAA,GACkB,OAAAO,EAAAI,OAAA,SAOLd,EAAIe,OAAO,KAAKC,KAAK,CAAEI,MAAO,iCAPzBV,EAAAT,KAAA,EAAA,MAAA,KAAA,EAAA,GASRG,EAASD,EAAW,GATZ,KAAZL,EAAYM,EAAZN,MAAmBC,MAAPoB,QAAA,SAAAd,EAAA,GAAA,OAAAK,EAAAI,OAAA,SAAAd,EAAAe,OAAA,KAAAC,KAAA,CAAAI,MAAA,iCAAAV,EAAAT,KAAA,GAAA,MAAA,KAAA,GAAA,OAAAK,EAAAD,EAAA,GAAAK,EAAAC,KAAA,GAAAD,EAAAT,KAAA,GAAAO,mBAAAa,MACKtB,MAAAA,QAAIa,SAAQC,IADjB,KAAA,GAAA,GACRX,EADQQ,EAAAY,KAAA,CAAAZ,EAAAT,KAAA,GAAA,MAAA,OAAAS,EAAAI,OAAA,SAETZ,EAAAA,OAFS,KAAAc,KAAA,CAAAI,MAAA,iDAAA,KAAA,GAAArB,EAAAQ,KAAAA,EAAAN,IAAAS,EAAAT,KAAA,GAAA,MAAA,KAAA,GAAA,OAAAS,EAAAC,KAAA,GAAAD,EAAAa,GAAAb,EAAA,MAAA,IAAAc,QAAAJ,MAAAV,EAAAa,IAAAb,EAAAI,OAAA,SAGkBG,EAAAA,OAAS,KAAAD,KAAA,CAAAI,MAAA,sCAH3B,KAAA,GAAA,IAAA,MAAA,OAAAV,EAAAe,SAAA,KAAA,KAAA,CAAA,CAAA,GAAA,gBAKRtB","file":"CheckUser.min.js","sourcesContent":["import User from \"../Model/User.js\"\r\nconst CheckUser = async (req, res, next) => {\r\n    const authHeader = req.headers.authorization;\r\n    if (!authHeader) {\r\n      return res.status(401).json({ message: \"Tài khoản chưa được cung cấp\" });\r\n    }\r\n    const tokenParts = authHeader.split(' ');\r\n    if (tokenParts.length !== 2 || tokenParts[0] !== 'Bearer') {\r\n      return res.status(401).json({ error: 'apiKey không đúng định dạng' });\r\n    }\r\n    const apiKey = tokenParts[1];\r\n    const apiKeyParts = apiKey.split('-');\r\n    if (apiKeyParts.length !== 4 || apiKeyParts[0] !== 'mern') {\r\n      return res.status(401).json({ error: 'apiKey không đúng định dạng' });\r\n    }\r\n    const userId = apiKeyParts[1];\r\n    try {\r\n      const user = await User.findById(userId);\r\n      if (!user) {\r\n        return res.status(401).json({ error: 'apiKey không hợp lệ hoặc user không tồn tại' });\r\n      }\r\n      req.user = user;\r\n      next();\r\n    } catch (err) {\r\n      console.error(err);\r\n      return res.status(500).json({ error: 'Lỗi hệ thống khi xác thực apiKey' });\r\n    }\r\n  };\r\n  \r\n  export default CheckUser;\r\n  "]}