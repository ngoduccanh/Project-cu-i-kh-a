"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Post=_interopRequireDefault(require("../Model/Post.js")),_Comment=_interopRequireDefault(require("../Model/Comment.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var PostController={createPost:function(t,r){var a,n,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.body,n=a.image,s=a.caption){e.next=3;break}return e.abrupt("return",r.status(400).json({error:"Image bắt buộc"}));case 3:return e.prev=3,o=new _Post.default({author:t.user._id,image:n,caption:s,likes:[],comments:[]}),e.next=7,regeneratorRuntime.awrap(o.save());case 7:r.status(201).json({message:"Tạo post thành công",post:o}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),r.status(500).json({error:"Lỗi khi tạo post"});case 13:case"end":return e.stop()}},null,null,[[3,10]])},getAllPosts:function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(_Post.default.find().populate("author","username avatar").populate({path:"comments",populate:{path:"author",select:"username avatar"}}).sort({createdAt:-1}));case 3:r=e.sent,t.json(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.status(500).json({error:"Lỗi khi lấy posts"});case 10:case"end":return e.stop()}},null,null,[[0,7]])},getUserPosts:function(t,r){var a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.userId,e.prev=1,e.next=4,regeneratorRuntime.awrap(_Post.default.find({author:a}).populate("author","username avatar").populate({path:"comments",populate:{path:"author",select:"username avatar"}}).sort({createdAt:-1}));case 4:n=e.sent,r.json(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r.status(500).json({error:"Lỗi khi lấy posts của user"});case 11:case"end":return e.stop()}},null,null,[[1,8]])},createComment:function(t,r){var a,n,s,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.body,n=a.postId,s=a.text){e.next=3;break}return e.abrupt("return",r.status(400).json({error:"Text bắt buộc"}));case 3:return e.prev=3,o=new _Comment.default({post:n,author:t.user._id,text:s}),e.next=7,regeneratorRuntime.awrap(o.save());case 7:return e.next=9,regeneratorRuntime.awrap(_Post.default.findById(n));case 9:return(u=e.sent).comments.push(o._id),e.next=13,regeneratorRuntime.awrap(u.save());case 13:r.status(201).json({message:"Tạo comment thành công",comment:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),r.status(500).json({error:"Lỗi khi tạo comment"});case 19:case"end":return e.stop()}},null,null,[[3,16]])}},_default=PostController;exports.default=_default;
//# sourceMappingURL=PostController.min.js.map
