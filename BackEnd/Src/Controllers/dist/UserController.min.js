"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _User=_interopRequireDefault(require("../Model/User.js")),_bcrypt=_interopRequireDefault(require("bcrypt")),_uuid=require("uuid"),_crypto=require("crypto");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var usersController={register:function(r,t){var n,a,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.email,s=n.password,a&&s){e.next=3;break}return e.abrupt("return",t.status(400).json({error:"Email và password là bắt buộc"}));case 3:return e.next=5,regeneratorRuntime.awrap(_User.default.findOne({email:a}));case 5:if(e.sent)return e.abrupt("return",t.status(404).json({error:"Email đã tồn tại"}));e.next=8;break;case 8:return u=new _User.default({email:a,password:s}),e.next=11,regeneratorRuntime.awrap(u.save());case 11:return e.abrupt("return",t.status(200).json({message:"Đăng kí thành công.",newAccont:u}));case 12:case"end":return e.stop()}})},login:function(r,t){var n,a,s,u,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.email,s=n.password,a&&s){e.next=3;break}return e.abrupt("return",t.status(400).json({error:"Email và password là bắt buộc"}));case 3:return e.prev=3,e.next=6,regeneratorRuntime.awrap(_User.default.findOne({email:a}));case 6:if(u=e.sent){e.next=9;break}return e.abrupt("return",t.status(404).json({error:"Email không tồn tại."}));case 9:return e.next=11,regeneratorRuntime.awrap(_bcrypt.default.compare(s,u.password));case 11:if(e.sent){e.next=14;break}return e.abrupt("return",t.status(401).json({error:"Sai mật khẩu."}));case 14:return o=(0,_crypto.randomBytes)(16).toString("hex"),c="mern-".concat(u.id,"-").concat(u.email,"-").concat(o),e.abrupt("return",t.status(200).json({message:"Đăng nhập thành công.",user:u,apiKey:c}));case 19:return e.prev=19,e.t0=e.catch(3),console.error(e.t0),e.abrupt("return",t.status(500).json({error:"Lỗi hệ thống"}));case 23:case"end":return e.stop()}},null,null,[[3,19]])},CreatUser:function(r,t){var n,a,s,u,o,c,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.username,s=n.avatar,u=n.bio,o=n.age,c=n.gender,a){e.next=3;break}return e.abrupt("return",t.status(400).json({message:"username không được để trống "}));case 3:return e.prev=3,i=new _User.default({username:a,age:o,gender:c,avatar:s,bio:u}),e.next=7,regeneratorRuntime.awrap(i.save());case 7:t.status(201).json({message:"Tạo mới User thành công",user:{id:(0,_uuid.v4)(),username:i.username}}),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(3),console.error(e.t0),e.abrupt("return",t.status(500).json({error:" Lỗi hệ thống"}));case 14:case"end":return e.stop()}},null,null,[[3,10]])},UserInfor:function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=r.user){e.next=4;break}return e.abrupt("return",t.status(404).json({message:"Không tìm thấy người dùng"}));case 4:a=n.username&&n.age,t.json({profileCreated:!!a,user:{username:n.username,avatar:n.avatar,age:n.age,gender:n.gender,bio:n.bio}}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),t.status(500).json({error:"Lỗi khi lấy thông tin user"});case 12:case"end":return e.stop()}},null,null,[[0,8]])},UpdateUser:function(r,t){var n,a,s,u,o,c,i,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,a=n.username,s=n.avatar,u=n.bio,o=n.age,c=n.gender,i=r.params.userId,a||t.status(400).json({message:"username không được để trống"}),e.prev=3,e.next=6,regeneratorRuntime.awrap(_User.default.findById(i));case 6:if(p=e.sent){e.next=9;break}return e.abrupt("return",t.status(404).json({message:"User không tồn tại"}));case 9:return p.username=a,o&&(p.age=o),c&&(p.gender=c),s&&(p.avatar=s),u&&(p.bio=u),e.next=16,regeneratorRuntime.awrap(p.save());case 16:t.status(200).json({message:"Cập nhật user thành công",user:{id:p._id,username:p.username}}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(3),console.error(e.t0),t.status(500).json({error:"Lỗi hệ thống"});case 23:case"end":return e.stop()}},null,null,[[3,19]])}},_default=usersController;exports.default=_default;
//# sourceMappingURL=UserController.min.js.map
